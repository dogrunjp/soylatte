!!! XML
!!!
%html
  %head
    %title= @report[:general][:study_title]
    %meta{:charset => "utf-8", :content => "text/html", "http-equiv" => "content"}
    // %link{:rel => :stylesheet, :href => "http://floating-fog-3562.heroku.com/fontin_sans.css", :type => "text/css"}
    %link{:rel => :stylesheet, :href => "http://g86.dbcls.jp/~iNut/bootstrap/css/bootstrap.min.css", :type => "text/css"}
    %link{:rel => :stylesheet, :href => "http://g86.dbcls.jp/~iNut/font-awesome/css/font-awesome.min.css", :type => "text/css"}
    %link{:rel => :stylesheet, :href => "/soy_style.css", :type => "text/css"}
  
  %body
    %script{ :src => "http://code.jquery.com/jquery-1.8.2.min.js" }
    %script{ :src => "http://g86.dbcls.jp/~iNut/bootstrap/js/bootstrap.js" }
    .navbar.navbar-fixed-top
      .navbar-inner
        .container
          %a.btn.btn-navbar{ "data-toggle" => "collapse", "data-target" => ".nav-collapse"}
            %span.icon-bar
            %span.icon-bar
            %span.icon-bar
          %a.brand
            DBCLS SRA metadata search (beta)
          .nav-collapse
            %ul.nav
              %li
                %a{:href => "/soylatte"} Home
              %li
                %a{:href => "http://g86.dbcls.jp/chateautogo"}blog
              %li
                %a{:href => "http://github.com/inutano/sra_metadata_toolkit"}
                  %i{ :class => "icon-github" }
              %li
                %a{:href => "http://twitter.com/inutano"}
                  %i{ :class => "icon-twitter" }
    
    %section
      %h2
        %i.icon-pencil.icon-large
        Project Summary
      %hr
      
      %p.lead= @report[:general][:study_title]
      %table.table.table-hover
        %thead
          %tr
            %th study type
            %th sample organism
            %th sequencing platform
        %tbody
          %tr
            %td= @report[:general][:study_type]
            %td= @report[:general][:scientific_name]
            %td= @report[:general][:instrument]
          
    - if @report[:paper]
      - @report[:paper].each do |paper|
        %section
          %h2 
            %i.icon-file.icon-large
            Article Summary
          %hr
          
          %h3= paper[:title]

          %blockquote
            %small= paper[:authors].join(", ")
            %small= paper[:journal] + ", " + paper[:date]
            %p= paper[:abstract]

          .paper_linkout
            %span.paper_linkout
              - pm_base = "http://www.ncbi.nlm.nih.gov/pubmed/"
              - pmc_base = "http://www.ncbi.nlm.nih.gov/pmc/articles/"
              %a.btn{ :href => pm_base + paper[:pmid] }
                %i.icon-file
                PubMed
              - if paper[:pmc]
                %a.btn{ :href => pmc_base + paper[:pmc][:pmcid] }
                  %i.icon-book
                  PMC
          
          - if paper[:pmc]
            - pmc = paper[:pmc]
            %section
            - if !pmc[:methods].empty?
              %h3 Methods
              .accordion#accordion2
                - pmc[:methods].each do |section_methods|
                  - if section_methods.has_key?(:subsec)
                    - section_methods[:subsec].each do |subsec|
                    - nospace = subsec[:subsec_title].gsub("\s","_")
                      .accordion-group
                        .accordion-heading
                          %a.accordion-toggle{ "data-toggle" => "collapse", "data-parent" => "#accordion2", :href => nospace.sub(/^/,"\#") }
                            = subsec[:subsec_title]
                        .accordion-body.collapse{ :id => nospace }
                          .accordion-inner
                            %blockquote
                              %p= subsec[:subsec_text].join("\n")
                  - else
                    - nospace = section_methods[:sec_title].gsub("\s","_")
                    .accordion-group
                      .accordion-heading
                        %a.accordion-toggle{ "data-toggle" => "collapse", "data-parent" => "#accordion2", :href => nospace.sub(/^/,"\#") }
                          = section_methods[:sec_title]
                      .accordion-body.collapse{ :id => nospace }
                        .accordion-inner
                          %blockquote
                            %p= section_methods[:sec_text].join("\n")

            - if !pmc[:results].empty?
              %h3 Results
              .accordion#accordion3
                - pmc[:results].each do |section_results|
                  - if section_results.has_key?(:subsec)
                    - section_results[:subsec].each do |subsec|
                    - nospace = subsec[:subsec_title].gsub("\s","_")
                      .accordion-group
                        .accordion-heading
                          %a.accordion-toggle{ "data-toggle" => "collapse", "data-parent" => "#accordion3", :href => nospace.sub(/^/,"\#") }
                            = subsec[:subsec_title]
                        .accordion-body.collapse{ :id => nospace }
                          .accordion-inner
                            %blockquote
                              %p= subsec[:subsec_text].join("\n")
                  - else
                    - nospace = section_results[:sec_title].gsub("\s","_")
                    .accordion-group
                      .accordion-heading
                        %a.accordion-toggle{ "data-toggle" => "collapse", "data-parent" => "#accordion2", :href => nospace.sub(/^/,"\#") }
                          = section_results[:sec_title]
                      .accordion-body.collapse{ :id => nospace }
                        .accordion-inner
                          %blockquote
                            %p= section_results[:sec_text].join("\n")
                            
              %h3 Cited by
              %ol
              - pmc[:cited_by].each do |citedby|
                %li
                  %a{ :href => "http://www.ncbi.nlm.nih.gov/pmc/articles/#{citedby[:pmcid]}" }= citedby[:title]
          
    %section
      %h2 
        %i.icon-reorder.icon-large
        Sequencing Profile
      %hr
      %table.table.table-hover
        %thead
          %tr
            %th runid
            %th sample id
            %th study type
            %th sample organism
            %th sequencing instrument
            %th library layout
            %th total number of sequence
            %th sequence length
        
        %tbody            
        - @report[:run_table].each do |row|
          - if !row[:read_profile]
            %tr
              %td
                %a{ :href => "/view/#{row[:runid]}" }= row[:runid]
              %td= row[:sampleid]
              %td= row[:study_type]
              %td= row[:organism]
              %td= row[:instrument]
              %td= row[:lib_layout]
              %td no data
              %td no data
          - else
            - row[:read_profile].each do |read|
              %tr
                %td
                  %a{ :href => "/view/#{read[:read]}" }= read[:read]
                %td= row[:sampleid]
                %td= row[:study_type]
                %td= row[:organism]
                %td= row[:instrument]
                %td= row[:lib_layout]
                %td= read[:total_seq]
                %td= read[:seq_length]
            
    %section
      %h2 
        %i.icon-beaker.icon-large.icon-spin
        Sample Profile
      %hr
      %table.table.table-hover
        %thead
          %tr
            %th sample id
            %th sample description
            %th run id
        
        %tbody
        - @report[:sample_table].each do |row|
          %tr
            %td= row[:sampleid]
            %td= row[:sample_description]
            %td= row[:runid].join(", ")

    %section
      %h2 
        %i.icon-share.icon-large
        Linkout/Resources
      %hr

      %ul
        - studyid = @report[:general][:studyid]
        %li
          %a{ :href => "http://trace.ddbj.nig.ac.jp/DRASearch/study?acc=" + studyid }
            DRASearch - DDBJ/DRA
        %li
          %a{ :href => "http://www.ebi.ac.uk/ena/data/view/" + studyid }
            ENA Browser - EBI/ENA
    
    %footer
      powered by
      %a{ :href => "http://dbcls.rois.ac.jp/en" }
        DBCLS
      , project licensed under CC-BY 2.1 JP. /
      Font Awesome by Dave Gandy - 
      %a{ :href => "http://fortawesome.github.com/Font-Awesome" }
        http://fortawesome.github.com/Font-Awesome
